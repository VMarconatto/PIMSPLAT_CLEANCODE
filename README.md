<div align="center">

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â•‘
â•‘        â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•   â•‘
â•‘        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘      â•‘
â•‘        â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘      â•‘
â•‘        â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘      â•‘
â•‘        â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•    â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•   â•šâ•â•      â•‘
â•‘                                                                              â•‘
â•‘                 Industrial PIMS â€” OPC-UA Â· RabbitMQ Â· PostgreSQL             â•‘
â•‘                          Clean Architecture  |  Beta Rev. 2                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-3178C6?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-22.x-339933?style=for-the-badge&logo=node.js&logoColor=white)](https://nodejs.org/)
[![React](https://img.shields.io/badge/React-19-61DAFB?style=for-the-badge&logo=react&logoColor=black)](https://react.dev/)
[![RabbitMQ](https://img.shields.io/badge/RabbitMQ-3.x-FF6600?style=for-the-badge&logo=rabbitmq&logoColor=white)](https://www.rabbitmq.com/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-336791?style=for-the-badge&logo=postgresql&logoColor=white)](https://www.postgresql.org/)
[![Docker](https://img.shields.io/badge/Docker-Compose-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://www.docker.com/)
[![OPC-UA](https://img.shields.io/badge/OPC--UA-node--opcua-green?style=for-the-badge)](https://github.com/node-opcua/node-opcua)
[![Status](https://img.shields.io/badge/Status-Beta%20Rev.2-orange?style=for-the-badge)]()

</div>

---

## `>_` O que Ã© este projeto?

> **Este repositÃ³rio tem propÃ³sito didÃ¡tico** â€” Ã© material de referÃªncia para o desenvolvimento de um **PIMS Industrial** (*Plant Information Management System*) com uma arquitetura de tecnologia profissional, voltada a ambientes de chÃ£o de fÃ¡brica reais.

Um **PIMS** Ã© o intermediador entre o **chÃ£o de fÃ¡brica** (PLCs, sensores, atuadores via OPC-UA) e sistemas superiores como **MES** (*Manufacturing Execution System*) e **ERP**. Este projeto implementa essa camada com foco em:

- **Confiabilidade** â€” transporte de dados via message broker com garantia de entrega
- **Escalabilidade** â€” arquitetura multi-client e multi-Ã¡rea desde o princÃ­pio
- **Rastreabilidade** â€” persistÃªncia em banco de dados relacional com timestamps precisos
- **Manutenibilidade** â€” Clean Architecture com separaÃ§Ã£o estrita de responsabilidades

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   CHÃƒO DE FÃBRICA          PIMS (este projeto)           SISTEMAS SUPERIORESâ”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PLC / SCADA â”‚â”€â”€â”€â”€â–¶â”‚  OPC-UA â†’ RabbitMQ       â”‚â”€â”€â”€â”€â–¶â”‚  MES / ERP     â”‚  â”‚
â”‚  â”‚  Sensores    â”‚     â”‚  Coleta Â· Transporte     â”‚     â”‚  RelatÃ³rios     â”‚  â”‚
â”‚  â”‚  Atuadores   â”‚â—€â”€â”€â”€â”€â”‚  PersistÃªncia Â· Alarmes  â”‚â—€â”€â”€â”€ â”‚  BI / Analyticsâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Nota sobre este repositÃ³rio:** Este repositÃ³rio foi criado como uma melhoria do RepositÃ³rio OpcuaMultiClient, com refatoraÃ§Ã£o de cÃ³digo e arquitetura, por tanto, o foco Ã© no backend. O frontend tevve algumas melhorias, mas nada de tÃ£o diferente quanto ao primeiro repositÃ³rio. Alguns mÃ³dulos de produÃ§Ã£o como telemetry nÃ£o foram versionados por fazerem parte de um desenvolvimento maior e proprietÃ¡rio. As partes versionadas incluem **Script de InicializaÃ§Ã£o**, toda a **camada RabbitMQ**, a **configuraÃ§Ã£o Docker Compose completa**, e o **MÃ³dulo de Alertas** e o **MÃ³dulo Commom para todos os modulos da aplicaÃ§Ã£o**. Os demais arquivos sÃ£o representaÃ§Ãµes estruturais que ilustram e facilitam o entendimento da arquitetura, servindo como material didÃ¡tico.

---

## `>_` Arquitetura do Sistema

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     VISÃƒO GERAL DA ARQUITETURA                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘   â”‚                        FRONTEND (React 19)                          â”‚    â•‘
â•‘   â”‚     Dashboard Â· Alarmes Â· OPC-UA Setup Â· ConfiguraÃ§Ã£o de Ranges     â”‚    â•‘
â•‘   â”‚                  React Router v7 Â· Styled Components                â”‚    â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                   â”‚ HTTP/REST (JWT Auth)                     â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘   â”‚                    BACKEND â€” Express API                            â”‚    â•‘
â•‘   â”‚                   Clean Architecture (4 mÃ³dulos)                    â”‚    â•‘
â•‘   â”‚                                                                     â”‚    â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â•‘ 
â•‘   â”‚   â”‚  common/    â”‚  â”‚ telemetry/  â”‚  â”‚  users/  â”‚  â”‚  alerts/   â”‚    â”‚    â•‘
â•‘   â”‚   â”‚  (base DI,  â”‚  â”‚ (OPC-UA,    â”‚  â”‚  (Auth,  â”‚  â”‚  (Alarmes, â”‚    â”‚    â•‘ 
â•‘   â”‚   â”‚   erros,    â”‚  â”‚  history,   â”‚  â”‚   JWT,   â”‚  â”‚   email,   â”‚    â”‚    â•‘
â•‘   â”‚   â”‚  TypeORM)   â”‚  â”‚  setups)    â”‚  â”‚  CRUD)   â”‚  â”‚  rate-lim) â”‚    â”‚    â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â•‘
â•‘                               â”‚                                              â•‘
â•‘                               â”‚ AMQP 0-9-1 (publish)                         â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘   â”‚                   ğŸ‡ RabbitMQ (Docker)                             â”‚     â•‘
â•‘   â”‚              topic exchange: telemetry.exchange                    â”‚     â•‘
â•‘   â”‚                                                                    â”‚     â•‘
â•‘   â”‚   Routing Key: telemetry.[Ã¡rea].[host_id].[linha].[tag]            â”‚     â•‘
â•‘   â”‚                                                                    â”‚     â•‘
â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â•‘
â•‘   â”‚   â”‚  Queue: pasteurizacao  â”‚  utilidades  â”‚  recepcao  â”‚  ...    â”‚ â”‚     â•‘
â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘               â”‚ consume              â”‚ consume         â”‚ consume             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
â•‘   â”‚ Consumer Worker  â”‚   â”‚ Consumer Worker  â”‚  â”‚  Consumer Worker     â”‚      â•‘
â•‘   â”‚  (PasteurizaÃ§Ã£o) â”‚   â”‚  (Utilidades)    â”‚  â”‚  (RecepÃ§Ã£o / ...)    â”‚      â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â•‘
â•‘               â”‚ persist              â”‚ persist         â”‚ persist             â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
â•‘   â”‚  PostgreSQL      â”‚   â”‚  PostgreSQL      â”‚  â”‚  PostgreSQL          â”‚      â•‘
â•‘   â”‚  :5432           â”‚   â”‚  :5433           â”‚  â”‚  :5434 / :5435 / ... â”‚      â•‘
â•‘   â”‚  (Docker)        â”‚   â”‚  (Docker)        â”‚  â”‚  (Docker)            â”‚      â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## `>_` Arquitetura Clean Code â€” Estrutura dos MÃ³dulos

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CLEAN ARCHITECTURE â€” CAMADAS POR MÃ“DULO                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚  Module: telemetry/  (mesmo padrÃ£o em: users/ Â· alerts/ Â· common/)    â”‚   â•‘
â•‘  â”‚                                                                       â”‚   â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â•‘
â•‘  â”‚  â”‚  DOMAIN  (nÃºcleo â€” zero dependÃªncias externas)                  â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ models/         OpcuaTagSetup, OpcuaClientProfile, ...     â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ repositories/   Interfaces (contratos abstratos)           â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ policies/       Regras de negÃ³cio puras                    â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â””â”€â”€ errors/         Erros de domÃ­nio especÃ­ficos               â”‚  â”‚   â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â•‘
â•‘  â”‚         â–²  (depende apenas da camada acima)                           â”‚   â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â•‘
â•‘  â”‚  â”‚  APPLICATION  (casos de uso â€” orquestra o domÃ­nio)              â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ usecases/       CreateTagSetup, UpdateAlarmSetpoints, ...  â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ dtos/           Objetos de transferÃªncia de dados          â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â””â”€â”€ launchers/      OpcuaInitializer, SetupInitializer         â”‚  â”‚   â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â•‘
â•‘  â”‚         â–²  (depende apenas das camadas acima)                         â”‚   â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â•‘
â•‘  â”‚  â”‚  INFRASTRUCTURE  (implementaÃ§Ãµes concretas â€” pode ser trocada)  â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ typeorm/        Entities, Repositories (raw SQL)           â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ opcua/          node-opcua client, main collector          â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â”œâ”€â”€ http/           Express Controllers, Routes                â”‚  â”‚   â•‘
â•‘  â”‚  â”‚  â””â”€â”€ container/      TSyringe â€” factories de injeÃ§Ã£o            â”‚  â”‚   â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â•‘ 
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## `>_` Stack de Tecnologias

### Backend

| Tecnologia | FunÃ§Ã£o | VersÃ£o |
|---|---|---|
| **Node.js** | Runtime de servidor | 22.x |
| **TypeScript** | Tipagem estÃ¡tica, ES2022 modules | 5.x |
| **Express 5** | Framework HTTP, API REST | 5.x |
| **node-opcua** | Cliente OPC-UA industrial | 2.x |
| **amqplib** | Driver AMQP para RabbitMQ | 0.5.x |
| **TypeORM** | ORM â€” migrations e queries | 0.3.x |
| **TSyringe** | InjeÃ§Ã£o de dependÃªncia (DI Container) | 4.x |
| **Zod** | ValidaÃ§Ã£o de schemas e env vars | 4.x |
| **jsonwebtoken** | AutenticaÃ§Ã£o JWT | 9.x |
| **bcryptjs** | Hash seguro de senhas | 3.x |
| **Pino** | Logger estruturado de alta performance | 10.x |
| **Nodemailer** | Envio de alertas por e-mail | 8.x |

### Infraestrutura

| Tecnologia | FunÃ§Ã£o |
|---|---|
| **Docker** | ContainerizaÃ§Ã£o de serviÃ§os |
| **Docker Compose** | OrquestraÃ§Ã£o local multi-container |
| **RabbitMQ** | Message Broker com Management UI |
| **PostgreSQL 16** | Banco de dados relacional (6 instÃ¢ncias) |

---

## `>_` Docker â€” O CoraÃ§Ã£o da Infraestrutura

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘             DOCKER COMPOSE â€” TOPOLOGIA DE CONTAINERS                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘   â”‚  docker-compose.yml  (9 containers ativos)                          â”‚    â•‘
â•‘   â”‚                                                                     â”‚    â•‘
â•‘   â”‚   rabbitmq          â”€â”€â”€ AMQP :5672 Â· Management UI :15672           â”‚    â•‘
â•‘   â”‚                                                                     â”‚    â•‘
â•‘   â”‚   postgres_past     â”€â”€â”€ :5432  (PasteurizaÃ§Ã£o)                      â”‚    â•‘
â•‘   â”‚   postgres_util     â”€â”€â”€ :5433  (Utilidades)                         â”‚    â•‘
â•‘   â”‚   postgres_rec      â”€â”€â”€ :5434  (RecepÃ§Ã£o)                           â”‚    â•‘
â•‘   â”‚   postgres_estoc    â”€â”€â”€ :5435  (Estocagem de Leite Cru)             â”‚    â•‘
â•‘   â”‚   postgres_exp      â”€â”€â”€ :5436  (ExpediÃ§Ã£o de Creme)                 â”‚    â•‘
â•‘   â”‚   postgres_als      â”€â”€â”€ :5437  (Alsafe)                             â”‚    â•‘
â•‘   â”‚                                                                     â”‚    â•‘
â•‘   â”‚   consumer_past     â”€â”€â”€ Worker â†’ consume telemetry.pasteurizacao    â”‚    â•‘
â•‘   â”‚   consumer_util     â”€â”€â”€ Worker â†’ consume telemetry.utilidades       â”‚    â•‘
â•‘   â”‚   ...                                                               â”‚    â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Por que Docker em ambientes industriais de chÃ£o de fÃ¡brica?

O uso de Docker neste projeto nÃ£o Ã© apenas uma escolha tÃ©cnica â€” Ã© uma **decisÃ£o arquitetural estratÃ©gica** com impacto direto na operaÃ§Ã£o industrial:

**`#` Isolamento e Reproducibilidade**
> Cada instÃ¢ncia do PostgreSQL roda em seu prÃ³prio container isolado. Problemas em uma Ã¡rea de produÃ§Ã£o (ex: PasteurizaÃ§Ã£o) nÃ£o afetam as demais (Utilidades, RecepÃ§Ã£o etc.). O ambiente local de desenvolvimento Ã© **idÃªntico** ao de produÃ§Ã£o.

**`#` Deploy sem FricÃ§Ã£o**
> Um Ãºnico comando `docker compose up -d` sobe toda a infraestrutura: RabbitMQ + bancos PostgreSQL + consumers. Sem instalaÃ§Ãµes manuais, sem configuraÃ§Ãµes de sistema. Qualquer engenheiro com Docker pode replicar o ambiente em minutos.

**`#` Escalabilidade Horizontal**
> Adicionar uma nova Ã¡rea de produÃ§Ã£o (ex: HomogeneizaÃ§Ã£o) significa **duplicar um serviÃ§o no docker-compose.yml**. O container herda todas as configuraÃ§Ãµes via variÃ¡veis de ambiente. Sem risco de configuraÃ§Ã£o manual errada.

**`#` Dados Persistentes e Seguros**
> Os volumes Docker garantem que os dados do PostgreSQL **sobrevivem ao ciclo de vida dos containers**. Restart, upgrade, recriaÃ§Ã£o â€” os dados permanecem intactos. CrÃ­tico em ambientes industriais onde a perda de histÃ³rico pode gerar nÃ£o-conformidades.

**`#` ServiÃ§os com Isolamento e TolerÃ¢ncia a Falhas**
> Cada Consumer Worker Ã© um **processo independente**, com sua prÃ³pria memÃ³ria e conexÃ£o de banco dedicada â€” seguindo o princÃ­pio de *responsabilidade Ãºnica* e *dados descentralizados* da arquitetura orientada a serviÃ§os. Falha de um consumer nÃ£o cascateia para os demais. O RabbitMQ garante que as mensagens pendentes sejam processadas quando o consumer reiniciar. Esta abordagem segue os **princÃ­pios de microserviÃ§os** (isolamento, baixo acoplamento, banco por serviÃ§o), implementada como *processos de sistema* no host fÃ­sico â€” um padrÃ£o hÃ­brido comum em ambientes industriais onde a latÃªncia de container Ã© indesejÃ¡vel para coleta de dados em tempo real.

**`#` Monitoramento Centralizado**
> O RabbitMQ Management UI (`:15672`) oferece visibilidade completa das filas, taxa de mensagens e consumers ativos â€” essencial para diagnÃ³stico em campo sem acesso a ferramentas externas.

---

## `>_` Fluxo de Dados â€” Da FÃ¡brica ao Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUXO COMPLETO DE TELEMETRIA                            â”‚
â”‚                                                                            â”‚
â”‚  1. COLETA (OPC-UA)                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ OpcuaInitializ â”‚  â† Carrega perfis de cliente do banco / JSON           â”‚
â”‚  â”‚ er.ts          â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚          â”‚ node-opcua subscription                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ client.ts      â”‚  â† Multiclient: mÃºltiplos servidores OPC-UA            â”‚
â”‚  â”‚ (node-opcua)   â”‚    Cada cliente monitora seus NodeIds                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                            â”‚
â”‚  2. TRANSPORTE (RabbitMQ)                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚          â”‚ publish                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ publisher.ts   â”‚  topic: telemetry.pasteurizacao.client01.line.FT01     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚          â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚               ğŸ‡ RabbitMQ Exchange (topic)                        â”‚     â”‚
â”‚  â”‚  Garantia de entrega Â· Dead-letter queues Â· Retry policy          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                            â”‚
â”‚  3. PROCESSAMENTO (Consumer)                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚          â”‚ consume                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ consumer.ts    â”‚  â† Valida, normaliza e persiste                        â”‚
â”‚  â”‚                â”‚    Verifica alarmes e dispara alertas                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                            â”‚
â”‚  4. PERSISTÃŠNCIA (PostgreSQL)                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚          â”‚ INSERT                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ telemetry_     â”‚  â† SÃ©rie temporal: tag, valor, timestamp, site         â”‚
â”‚  â”‚ samples        â”‚    Migrations via TypeORM                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                            â”‚
â”‚  5. VISUALIZAÃ‡ÃƒO (Frontend React)                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚          â”‚ GET /api/telemetry/:clientId/history                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ Dashboard      â”‚  â† Recharts Â· Realtime SSE Â· Filtros por Ã¡rea          â”‚
â”‚  â”‚ (React 19)     â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## `>_` Multi-Client OPC-UA

Uma das caracterÃ­sticas centrais deste PIMS Ã© a capacidade de gerenciar **mÃºltiplos clientes OPC-UA simultaneamente**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GERENCIADOR MULTI-CLIENT OPC-UA                     â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚   Client01      â”‚    â”‚   Client02      â”‚    â”‚   Client03       â”‚    â”‚
â”‚   â”‚  opc.tcp://     â”‚    â”‚  opc.tcp://     â”‚    â”‚  opc.tcp://      â”‚    â”‚
â”‚   â”‚  plc01:4840     â”‚    â”‚  plc02:4840     â”‚    â”‚  pasteuriz:4840  â”‚    â”‚
â”‚   â”‚                 â”‚    â”‚                 â”‚    â”‚                  â”‚    â”‚
â”‚   â”‚  mapMemory:     â”‚    â”‚  mapMemory:     â”‚    â”‚  mapMemory:      â”‚    â”‚
â”‚   â”‚  [FT01, PT01,   â”‚    â”‚  [LT01, LT02,   â”‚    â”‚  [CT01, CT02,    â”‚    â”‚
â”‚   â”‚   PT04, ...]    â”‚    â”‚   PT07, ...]    â”‚    â”‚   FT03, ...]     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚                      â”‚                       â”‚             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                   â”‚                                     â”‚
â”‚                          publish to RabbitMQ                            â”‚
â”‚                    telemetry.{Ã¡rea}.{clientId}.{linha}.{tag}            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Cada cliente OPC-UA Ã© configurado individualmente com:
- **Endpoint** de conexÃ£o (`opc.tcp://host:porta`)
- **NodeIds** a monitorar (`mapMemory`)
- **PolÃ­ticas de seguranÃ§a** (securityMode, securityPolicy)
- **ParÃ¢metros de retry** (initialDelay, maxRetry, maxDelay)
- **Namespace** OPC-UA do servidor

---

## `>_` InjeÃ§Ã£o de DependÃªncia com TSyringe

O projeto utiliza **TSyringe** como container de injeÃ§Ã£o de dependÃªncia, seguindo o padrÃ£o de **factory functions** para garantir que as instÃ¢ncias sejam criadas com suas dependÃªncias corretamente resolvidas:

```typescript
// Pattern DI â€” cada mÃ³dulo registra suas dependÃªncias
container.registerSingleton('OpcuaTagSetupRepository', OpcuaTagSetupTypeormRepository)

container.register('CreateTagSetupUseCase', {
  useFactory: (c) => new CreateTagSetupUseCase(
    c.resolve('OpcuaTagSetupRepository')
  )
})

// No controller â€” resolve o use case pronto para uso:
const useCase = container.resolve<CreateTagSetupUseCase>('CreateTagSetupUseCase')
```

BenefÃ­cios desta abordagem:
- **Zero acoplamento** entre camadas â€” o controller nÃ£o conhece a implementaÃ§Ã£o do repositÃ³rio
- **Testabilidade** â€” repositÃ³rios podem ser trocados por mocks em testes
- **ConfiguraÃ§Ã£o centralizada** â€” todo o grafo de dependÃªncias em um Ãºnico arquivo `container/index.ts`

---

## `>_` TypeORM â€” Gerenciamento Profissional de Banco de Dados

O TypeORM Ã© utilizado com **raw SQL via QueryRunner**, combinando o melhor dos dois mundos:

```
Migrations controladas    +    Queries SQL explÃ­citas
     (TypeORM)                       (raw SQL)
         â”‚                               â”‚
         â–¼                               â–¼
Versionamento do schema          Performance mÃ¡xima
Rollback automÃ¡tico              Sem overhead do ORM
Deploy reproduzÃ­vel              Queries otimizadas
```

**Migrations disponÃ­veis:**

```
1768323320214 â€” CreateOpcuaClients
1768676034633 â€” CreateUsers
1768847601673 â€” CreateUserTokens
1769012345678 â€” CreateAlertsSamples
1771632000000 â€” AddColumnsToOpcuaClients
1771718400000 â€” CreateOpcuaTagSetups
```

---

## `>_` Estrutura de DiretÃ³rios

```
typescript-rabbitmq-master/
â”‚
â”œâ”€â”€ docker-compose.yml              â† Infraestrutura completa (RabbitMQ + 6x Postgres)
â”œâ”€â”€ .env                            â† VariÃ¡veis de ambiente
â”‚
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ common/                 â† Base compartilhada (DI, erros, TypeORM, auth)
â”‚       â”‚   â”œâ”€â”€ domain/errors/      â† AppError, NotFoundError, ConflictError...
â”‚       â”‚   â”œâ”€â”€ domain/providers/   â† Interfaces: AuthProvider, HashProvider
â”‚       â”‚   â”œâ”€â”€ infrastructure/
â”‚       â”‚   â”‚   â”œâ”€â”€ container/      â† TSyringe: registro de dependÃªncias globais
â”‚       â”‚   â”‚   â”œâ”€â”€ http/           â† Express app, server, middlewares JWT
â”‚       â”‚   â”‚   â”œâ”€â”€ providers/      â† JWT e bcryptjs implementations
â”‚       â”‚   â”‚   â””â”€â”€ typeorm/        â† DataSource + migrations
â”‚       â”‚   â””â”€â”€ system/             â† Health check, email alerts
â”‚       â”‚
â”‚       â”œâ”€â”€ telemetry/              â† MÃ³dulo principal: OPC-UA + persistÃªncia
â”‚       â”‚   â”œâ”€â”€ domain/             â† Models, repositories interfaces, policies
â”‚       â”‚   â”œâ”€â”€ app/usecases/       â† CRUD de setups, histÃ³rico, snapshot realtime
â”‚       â”‚   â””â”€â”€ infrastructure/
â”‚       â”‚       â”œâ”€â”€ opcua/          â† node-opcua client + initializer
â”‚       â”‚       â”œâ”€â”€ typeorm/        â† RepositÃ³rios com raw SQL
â”‚       â”‚       â”œâ”€â”€ http/           â† Controllers + rotas REST
â”‚       â”‚       â””â”€â”€ container/      â† DI factories do mÃ³dulo
â”‚       â”‚
â”‚       â”œâ”€â”€ messaging/              â† Camada RabbitMQ (transporte de dados)
â”‚       â”‚   â”œâ”€â”€ rabbitmq.connection.ts  â† AMQP connection management
â”‚       â”‚   â”œâ”€â”€ rabbitmq.setup.ts       â† Topology: exchanges, queues, bindings
â”‚       â”‚   â”œâ”€â”€ publisher.ts            â† Publica telemetria no exchange
â”‚       â”‚   â”œâ”€â”€ consumer.ts             â† Processa mensagens e persiste
â”‚       â”‚   â””â”€â”€ retry.ts                â† Dead-letter e retry policy
â”‚       â”‚
â”‚       â”œâ”€â”€ alerts/                 â† MÃ³dulo de alarmes e notificaÃ§Ãµes
â”‚       â”‚   â”œâ”€â”€ domain/policies/    â† rateLimitPolicy (anti-spam de alertas)
â”‚       â”‚   â””â”€â”€ infrastructure/     â† PersistÃªncia + e-mail via Nodemailer
â”‚       â”‚
â”‚       â””â”€â”€ users/                  â† MÃ³dulo de autenticaÃ§Ã£o e usuÃ¡rios
â”‚           â”œâ”€â”€ domain/entities/    â† User entity
â”‚           â””â”€â”€ infrastructure/     â† JWT auth, bcrypt, routes
â”‚
â””â”€â”€ frontend/
    â””â”€â”€ src/
        â”œâ”€â”€ pages/                  â† Dashboard, Alarms, OpcuaSetup, RangeSetup...
        â”œâ”€â”€ components/             â† OpcuaBox, RabbitMQBox, HostMetrics, Charts...
        â”œâ”€â”€ hooks/                  â† useAuth, useTheme
        â”œâ”€â”€ styles/themes/          â† dark.ts / light.ts
        â””â”€â”€ routes/                 â† Protected routes (JWT) + auth routes
```

---

## `>_` PÃ¡ginas do Frontend

| Rota | PÃ¡gina | DescriÃ§Ã£o |
|---|---|---|
| `/dashboard` | **Analytics** | Dashboard principal com histÃ³rico, grÃ¡ficos Recharts, filtros por Ã¡rea e perÃ­odo |
| `/metrics` | **AppMetrics** | MÃ©tricas do sistema: host, RabbitMQ, OPC-UA, banco de dados |
| `/alarms` | **AlarmsList** | Lista em tempo real de alarmes ativos por Ã¡rea e tag |
| `/alertssent` | **AlertsSent** | HistÃ³rico de alertas enviados por e-mail com timestamps |
| `/opcuaclients` | **OpcuaClientList** | Gerenciamento de perfis de cliente OPC-UA (CRUD) |
| `/analogsetup` | **AnalogsSetup** | ConfiguraÃ§Ã£o de setpoints de alarme (L, LL, H, HH) por tag |

---

## `>_` Como Executar

### PrÃ©-requisitos

```bash
node --version    # >= 22.x
docker --version  # >= 25.x
```

### 1. Subir a Infraestrutura Docker

```bash
# Na raiz do projeto
docker compose up -d --wait

# Verificar status
docker compose ps
```

Aguarda atÃ© que todos os health checks passem (`--wait`). O RabbitMQ Management UI estarÃ¡ disponÃ­vel em `http://localhost:15672` (user: `guest` / pass: `guest`).

### 2. Configurar VariÃ¡veis de Ambiente

```bash
cp .env .env.local
```

VariÃ¡veis essenciais:

```bash
RABBITMQ_URL=amqp://guest:guest@localhost:5672
DB_HOST=localhost
DB_PORT=5432
DB_NAME=postgres
DB_USER=postgres
DB_PASS=postgres
JWT_SECRET=seu_secret_aqui
SITE=NomeDaArea
HOST_ID=Client01
```

### 3. Backend â€” Build e Start

```bash
cd backend
npm install
npm run build
npm run start:api        # API Express (:3000)
npm run start:collector  # Coletor OPC-UA
npm run start:consumer   # Consumer RabbitMQ
# ou tudo junto:
npm run start:stack
```

### 4. Frontend â€” Dev Server

```bash
cd frontend
npm install
npm start    # http://localhost:3001
```

### 5. Migrations

```bash
cd backend
npm run typeorm migration:run
```

---

## `>_` VariÃ¡veis de Ambiente â€” ReferÃªncia

| VariÃ¡vel | DescriÃ§Ã£o | PadrÃ£o |
|---|---|---|
| `RABBITMQ_URL` | URL de conexÃ£o AMQP | `amqp://guest:guest@localhost:5672` |
| `RABBITMQ_EXCHANGE` | Nome do exchange topic | `telemetry.exchange` |
| `RABBITMQ_ROUTING_KEY` | PadrÃ£o de routing key | `telemetry.#` |
| `RABBITMQ_PREFETCH` | Mensagens em paralelo por consumer | `50` |
| `OPCUA_ENABLE_RABBIT` | Habilita publish RabbitMQ | `true` |
| `SITE` | Slug da Ã¡rea de produÃ§Ã£o | `Utilidades` |
| `HOST_ID` | Identificador do host OPC-UA | `Client01` |
| `DB_HOST` | Host PostgreSQL | `localhost` |
| `DB_PORT` | Porta PostgreSQL | `5432` |
| `JWT_SECRET` | Chave de assinatura JWT | â€” |
| `JWT_EXPIRES_IN` | TTL do token (segundos) | `86400` |
| `ALERT_EMAIL_USER` | Conta SMTP para alertas | â€” |
| `ALERT_EMAIL_DESTINATION` | DestinatÃ¡rio dos alertas | â€” |

---

## `>_` Contexto Industrial

Este projeto foi desenvolvido como material de referÃªncia para uma **planta de processamento de laticÃ­nios**, com as seguintes Ã¡reas de produÃ§Ã£o monitoradas:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ÃREAS DE PRODUÃ‡ÃƒO MONITORADAS                           â”‚
â”‚                                                                      â”‚
â”‚   PasteurizaÃ§Ã£o        â”€â”€â”€ Fluxo, PressÃ£o, Temperatura, CIP          â”‚
â”‚   Utilidades           â”€â”€â”€ Caldeira, Compressores, Ãgua Gelada       â”‚
â”‚   RecepÃ§Ã£o             â”€â”€â”€ Tanques de recepÃ§Ã£o de leite cru          â”‚
â”‚   Estocagem Leite Cru  â”€â”€â”€ NÃ­vel, PressÃ£o, Condutividade             â”‚
â”‚   ExpediÃ§Ã£o de Creme   â”€â”€â”€ VazÃ£o, Temperatura, Peso                  â”‚
â”‚   Alsafe               â”€â”€â”€ Sistemas de seguranÃ§a e utilidades        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tags instrumentadas (exemplos):**

| Tag | DescriÃ§Ã£o | Unidade | Alarmes |
|---|---|---|---|
| `FT01` | Baia 01 â€” VazÃ£o de saÃ­da | mÂ³/h | L=10, HH=42 |
| `PT04` | Baia 01 â€” PressÃ£o saÃ­da de linha | bar | LL=2, HH=11 |
| `LT01` | Tanque 1 â€” NÃ­vel de Leite Cru | % | L=20, LL=10, HH=94 |
| `CT01` | Manifold â€” Condutividade | mS/cm | L=30, LL=20, HH=60 |
| `PT07` | Tanque 1 â€” PressÃ£o | bar | HH=4.9 |

---

## `>_` PrÃ³ximas EvoluÃ§Ãµes (Roadmap)

```
[âœ“] Dashboard realtime via SSE (Server-Sent Events)
[âœ“] Alarmes com nÃ­veis L / LL / H / HH configurÃ¡veis por tag
[âœ“] Multi-tenant: isolamento por Ã¡rea via routing key RabbitMQ
[âœ“] AutenticaÃ§Ã£o JWT com refresh token
[ ] MigraÃ§Ã£o de opcuaClientConfig.json â†’ tabela opcua_clients (em andamento)
[ ] OpcuaInitializer lendo perfis do banco de dados
[ ] Testes unitÃ¡rios por mÃ³dulo (jest + testcontainers)
[ ] CI/CD pipeline (GitHub Actions)
[ ] IntegraÃ§Ã£o MES via REST/MQTT
```

---

## `>_` LicenÃ§a

```
MIT License â€” use, estude, adapte e compartilhe.

Este repositÃ³rio Ã© material didÃ¡tico aberto. Se este projeto
te ajudou a entender PIMS industrial, Clean Architecture ou
integraÃ§Ã£o OPC-UA/RabbitMQ â€” uma estrela no repositÃ³rio Ã©
muito bem-vinda. â­
```

---

<div align="center">

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘   Desenvolvido com foco em educaÃ§Ã£o e boas prÃ¡ticas           â•‘
â•‘   para engenharia de software em ambientes industriais        â•‘
â•‘                                                               â•‘
â•‘        OPC-UA  Â·  RabbitMQ  Â·  PostgreSQL  Â·  Docker          â•‘
â•‘          Clean Architecture  Â·  TypeScript  Â·  React          â•‘
â•‘                                                               â•‘
â•‘                      Beta Rev. 2  â€”  2026                     â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

</div>

---

## `>_` Screenshots do Frontend

**Imagem 1 â€” ConfiguraÃ§Ã£o de Cliente OPC-UA**

![OPCUA Client Configuration](screenshots/Post_Opcua_Perfil.png)

FormulÃ¡rio completo de cadastro de um cliente OPC-UA. Permite definir o nome da aplicaÃ§Ã£o, endpoint de conexÃ£o (`opc.tcp://`), parÃ¢metros de retry (Initial Delay, Max Retry, Max Delay), modo e polÃ­tica de seguranÃ§a, namespace do servidor, e o `Map Memory` â€” lista de NodeIds (tags) que o cliente irÃ¡ monitorar. Os dados podem ser salvos no banco de dados ou exportados como JSON.

---

**Imagem 2 â€” Load Connection Profile**

![Load Connection Profile](screenshots/Load%20Connection%20Profile.png)

Modal de carregamento de perfis de conexÃ£o OPC-UA. Exibe os perfis disponÃ­veis em duas fontes distintas: banco de dados PostgreSQL (Database) e arquivos JSON locais (`backend/src/`). Cada perfil pode ser carregado diretamente no formulÃ¡rio de configuraÃ§Ã£o com um clique em **Load**, permitindo alternar rapidamente entre diferentes clientes sem redigitar os dados.

---

**Imagem 3 â€” Load Setup Configuration**

![Load Setup Configuration](screenshots/Load%20Setup%20Configuration.png)

Modal de carregamento de configuraÃ§Ãµes de setup de tags OPC-UA. Assim como o perfil de conexÃ£o, as configuraÃ§Ãµes de variÃ¡veis analÃ³gicas (setpoints, unidades, descriÃ§Ãµes) podem ser carregadas tanto do banco de dados (`opcua_tag_setups`) quanto de arquivos JSON locais. Garante portabilidade e versionamento das configuraÃ§Ãµes de planta.

---

**Imagem 4 â€” Analog Variable Settings**

![Analog Variable Settings](screenshots/Analog%20Variable%20Settings.png)

PÃ¡gina de configuraÃ§Ã£o de variÃ¡veis analÃ³gicas por cliente OPC-UA. Lista todas as tags monitoradas (CT01, CT02, FT01, FT02...) com campos editÃ¡veis para unidade de engenharia, descriÃ§Ã£o e os quatro nÃ­veis de setpoint de alarme: **SP ALARM L** (Low), **SP ALARM LL** (Low-Low), **SP ALARM H** (High) e **SP ALARM HH** (High-High). Ã‰ a interface central para parametrizaÃ§Ã£o dos limites de alarme da planta.

---

**Imagem 5 â€” Service Metrics**

![Service Metrics](screenshots/Service%20Metrics.png)

PÃ¡gina de mÃ©tricas do sistema (AppMetrics). Exibe em tempo real o status do coletor OPC-UA, mÃ©tricas do host (CPU, uso de memÃ³ria RAM), e o painel de gerenciamento do **RabbitMQ Management UI** embarcado na interface, mostrando os channels AMQP ativos, filas, taxa de publicaÃ§Ã£o e consumo de mensagens â€” essencial para diagnÃ³stico operacional sem sair do sistema.

---

**Imagem 6 â€” Analog Dashboard**

![Analog Dashboards](screenshots/Analog%20Dashboards.png)

Dashboard principal de telemetria. Apresenta grÃ¡ficos de sÃ©rie temporal (Recharts) para mÃºltiplas tags analÃ³gicas simultaneamente, com filtros por Ã¡rea de produÃ§Ã£o (PasteurizaÃ§Ã£o, Utilidades, RecepÃ§Ã£o etc.) e intervalo de tempo. Inclui um grÃ¡fico de distribuiÃ§Ã£o de falhas por tag (donut chart), configuraÃ§Ã£o de cores individuais por variÃ¡vel e indicadores de produÃ§Ã£o acumulada â€” visÃ£o consolidada do chÃ£o de fÃ¡brica em tempo real.
